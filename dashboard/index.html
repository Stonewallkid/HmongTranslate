<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hmong Translation Project - Dashboard</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --success: #16a34a;
            --warning: #f59e0b;
            --danger: #dc2626;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
        }

        /* Layout */
        .app {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 240px;
            background: var(--text);
            color: white;
            padding: 1.5rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar h1 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .sidebar-subtitle {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .nav-item {
            display: block;
            padding: 0.75rem 1rem;
            color: #94a3b8;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-item.active {
            background: var(--primary);
        }

        .main {
            flex: 1;
            margin-left: 240px;
            padding: 2rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card h3 {
            font-size: 1rem;
            margin-bottom: 0.75rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .stat-card.success .stat-value { color: var(--success); }
        .stat-card.warning .stat-value { color: var(--warning); }
        .stat-card.danger .stat-value { color: var(--danger); }

        /* Progress Bar */
        .progress-bar {
            background: var(--border);
            border-radius: 4px;
            height: 8px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }

        .progress-fill.success { background: var(--success); }
        .progress-fill.warning { background: var(--warning); }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        tr:hover {
            background: #f8fafc;
        }

        /* Buttons */
        button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--border);
            color: var(--text);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.875rem;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Checklist */
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: #f8fafc;
        }

        .checklist-item.completed {
            background: #f0fdf4;
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
        }

        .checklist-content {
            flex: 1;
        }

        .checklist-title {
            font-weight: 500;
        }

        .checklist-item.completed .checklist-title {
            text-decoration: line-through;
            color: var(--text-light);
        }

        .checklist-meta {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        /* Calendar */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-header {
            background: var(--primary);
            color: white;
            padding: 0.5rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .calendar-day {
            background: white;
            padding: 0.5rem;
            min-height: 80px;
            font-size: 0.875rem;
        }

        .calendar-day.other-month {
            color: var(--text-light);
            background: #f8fafc;
        }

        .calendar-day.today {
            background: #eff6ff;
        }

        .calendar-date {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .calendar-event {
            font-size: 0.7rem;
            padding: 2px 4px;
            border-radius: 3px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-event.deadline {
            background: #fef2f2;
            color: var(--danger);
        }

        .calendar-event.session {
            background: #eff6ff;
            color: var(--primary);
        }

        .calendar-event.reminder {
            background: #fefce8;
            color: var(--warning);
        }

        /* Status Badges */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success {
            background: #dcfce7;
            color: #166534;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            margin-bottom: 1rem;
        }

        .modal-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        /* Notifications */
        .notification-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .notification-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }

        .notification-icon.deadline {
            background: #fee2e2;
            color: var(--danger);
        }

        .notification-icon.reminder {
            background: #fef3c7;
            color: var(--warning);
        }

        .notification-icon.success {
            background: #dcfce7;
            color: var(--success);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 500;
        }

        .notification-time {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 1024px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* Phrase corrections list */
        .correction-item {
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .correction-original {
            color: var(--text-light);
            text-decoration: line-through;
        }

        .correction-new {
            color: var(--success);
            font-weight: 500;
        }

        .correction-meta {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        /* Calendar navigation */
        .calendar-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .calendar-nav h3 {
            margin: 0;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        /* Phrase Editor */
        .phrase-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .phrase-card.edited {
            border-color: var(--warning);
            background: #fffbeb;
        }

        .phrase-card .phrase-number {
            font-size: 0.7rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .phrase-card .phrase-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .phrase-card .phrase-field label {
            display: block;
            font-size: 0.7rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
        }

        .phrase-card input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .phrase-card input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .phrase-card .phrase-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            justify-content: flex-end;
        }

        .phrase-card .edited-badge {
            display: inline-block;
            background: var(--warning);
            color: white;
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            margin-left: 0.5rem;
        }

        @media (max-width: 768px) {
            .phrase-card .phrase-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <nav class="sidebar">
            <h1>Hmong Translation</h1>
            <p class="sidebar-subtitle">Project Dashboard</p>

            <a class="nav-item active" onclick="showPage('overview')">Overview</a>
            <a class="nav-item" onclick="showPage('checklist')">Checklist</a>
            <a class="nav-item" onclick="showPage('speakers')">Speakers</a>
            <a class="nav-item" onclick="showPage('sessions')">Sessions</a>
            <a class="nav-item" onclick="showPage('calendar')">Calendar</a>
            <a class="nav-item" onclick="showPage('phrases')">Phrase Editor</a>
            <a class="nav-item" onclick="showPage('corrections')">Corrections</a>
            <a class="nav-item" onclick="showPage('settings')">Settings</a>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- Overview Page -->
            <div id="overview-page" class="page active">
                <h2 style="margin-bottom: 1.5rem;">Project Overview</h2>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-speakers">0</div>
                        <div class="stat-label">Speakers Enrolled</div>
                        <div class="progress-bar"><div class="progress-fill" id="progress-speakers" style="width: 0%"></div></div>
                        <div class="stat-label">Goal: 25</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value" id="stat-recordings">0</div>
                        <div class="stat-label">Total Recordings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-hours">0</div>
                        <div class="stat-label">Hours Recorded</div>
                        <div class="progress-bar"><div class="progress-fill success" id="progress-hours" style="width: 0%"></div></div>
                        <div class="stat-label">Goal: 125 hrs</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-value" id="stat-corrections">0</div>
                        <div class="stat-label">Phrase Corrections</div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h2>Upcoming Deadlines</h2>
                        <div id="upcoming-deadlines">
                            <div class="empty-state">No upcoming deadlines</div>
                        </div>
                    </div>

                    <div class="card">
                        <h2>Recent Activity</h2>
                        <div id="recent-activity">
                            <div class="empty-state">No recent activity</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Quick Actions</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn-primary" onclick="showPage('speakers'); showAddSpeakerModal();">+ Add Speaker</button>
                        <button class="btn-secondary" onclick="showPage('sessions'); showAddSessionModal();">+ Log Session</button>
                        <button class="btn-secondary" onclick="showPage('calendar'); showAddEventModal();">+ Add Calendar Event</button>
                        <button class="btn-secondary" onclick="exportAllData();">Export All Data</button>
                    </div>
                </div>
            </div>

            <!-- Checklist Page -->
            <div id="checklist-page" class="page">
                <h2 style="margin-bottom: 1.5rem;">Project Checklist</h2>

                <div class="card">
                    <h3>Phase 1: Preparation</h3>
                    <div id="checklist-prep"></div>
                </div>

                <div class="card">
                    <h3>Phase 2: Recruiting</h3>
                    <div id="checklist-recruit"></div>
                </div>

                <div class="card">
                    <h3>Phase 3: Recording</h3>
                    <div id="checklist-recording"></div>
                </div>

                <div class="card">
                    <h3>Phase 4: Transcription & Processing</h3>
                    <div id="checklist-transcription"></div>
                </div>
            </div>

            <!-- Speakers Page -->
            <div id="speakers-page" class="page">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>Speakers</h2>
                    <button class="btn-primary" onclick="showAddSpeakerModal()">+ Add Speaker</button>
                </div>

                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Dialect</th>
                                <th>Sessions</th>
                                <th>Recordings</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="speakers-table">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sessions Page -->
            <div id="sessions-page" class="page">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>Recording Sessions</h2>
                    <button class="btn-primary" onclick="showAddSessionModal()">+ Log Session</button>
                </div>

                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Speaker</th>
                                <th>Session #</th>
                                <th>Categories</th>
                                <th>Recordings</th>
                                <th>Duration</th>
                                <th>Quality</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sessions-table">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Calendar Page -->
            <div id="calendar-page" class="page">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>Calendar</h2>
                    <button class="btn-primary" onclick="showAddEventModal()">+ Add Event</button>
                </div>

                <div class="card">
                    <div class="calendar-nav">
                        <button class="btn-secondary" onclick="prevMonth()">&lt; Previous</button>
                        <h3 id="calendar-month-label"></h3>
                        <button class="btn-secondary" onclick="nextMonth()">Next &gt;</button>
                    </div>
                    <div class="calendar" id="calendar-grid">
                    </div>
                </div>

                <div class="card">
                    <h3>Upcoming Events</h3>
                    <div id="upcoming-events"></div>
                </div>
            </div>

            <!-- Corrections Page -->
            <div id="corrections-page" class="page">
                <h2 style="margin-bottom: 1.5rem;">Phrase Corrections</h2>

                <div class="card">
                    <p style="color: var(--text-light); margin-bottom: 1rem;">
                        Speakers can flag or edit phrases they believe are incorrect.
                        Review these corrections and approve or reject them.
                    </p>

                    <div id="corrections-list">
                        <div class="empty-state">No corrections submitted yet</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Import Corrections from Recording Tool</h3>
                    <p style="color: var(--text-light); margin-bottom: 1rem;">
                        Upload a metadata.json file from a speaker's export to import their phrase corrections.
                    </p>
                    <input type="file" id="corrections-file" accept=".json" onchange="importCorrections(event)">
                </div>
            </div>

            <!-- Phrase Editor Page -->
            <div id="phrases-page" class="page">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h2>Phrase Editor</h2>
                        <p style="color: var(--text-light);">Edit Hmong and English phrases directly</p>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <span id="phrase-edit-count" style="padding: 0.5rem 1rem; background: var(--warning); color: white; border-radius: 6px; font-weight: 500;">0 edits</span>
                        <button class="btn-primary" onclick="exportEditedPhrases()">Export Phrases</button>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 1rem;">
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                        <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                            <select id="phrase-domain-select" onchange="updateCategorySelect()">
                                <option value="">Select Domain...</option>
                                <option value="everyday">Everyday</option>
                                <option value="medical">Medical</option>
                                <option value="emergency">Emergency</option>
                                <option value="legal">Legal</option>
                                <option value="numbers">Numbers</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                            <select id="phrase-category-select" onchange="loadPhraseCategory()" disabled>
                                <option value="">Select Category...</option>
                            </select>
                        </div>
                        <button id="add-phrase-btn" class="btn-primary" onclick="showAddPhraseModal()" disabled style="white-space: nowrap;">+ Add Phrase</button>
                        <div class="form-group" style="margin: 0; flex: 2; min-width: 250px;">
                            <input type="text" id="phrase-search" placeholder="Search phrases..." oninput="filterPhrases()">
                        </div>
                    </div>
                </div>

                <div id="phrase-editor-stats" class="stats-grid" style="margin-bottom: 1rem;">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-total-phrases">475</div>
                        <div class="stat-label">Total Phrases</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-value" id="stat-edited-phrases">0</div>
                        <div class="stat-label">Edited</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value" id="stat-added-phrases">0</div>
                        <div class="stat-label">Added</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-value" id="stat-deleted-phrases">0</div>
                        <div class="stat-label">Deleted</div>
                    </div>
                </div>

                <div id="phrase-list">
                    <div class="card">
                        <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                            Select a domain and category above to edit phrases
                        </p>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page">
                <h2 style="margin-bottom: 1.5rem;">Settings</h2>

                <div class="card">
                    <h3>Project Information</h3>
                    <div class="form-group">
                        <label>Project Name</label>
                        <input type="text" id="setting-project-name" value="Hmong Translation Project">
                    </div>
                    <div class="form-group">
                        <label>Coordinator Name</label>
                        <input type="text" id="setting-coordinator-name">
                    </div>
                    <div class="form-group">
                        <label>Coordinator Email</label>
                        <input type="email" id="setting-coordinator-email">
                    </div>
                    <div class="form-group">
                        <label>Coordinator Phone</label>
                        <input type="tel" id="setting-coordinator-phone">
                    </div>
                    <button class="btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>

                <div class="card">
                    <h3>Data Management</h3>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn-secondary" onclick="exportAllData()">Export All Data</button>
                        <button class="btn-secondary" onclick="document.getElementById('import-file').click()">Import Data</button>
                        <input type="file" id="import-file" style="display: none;" accept=".json" onchange="importData(event)">
                        <button class="btn-danger" onclick="clearAllData()">Clear All Data</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Notification Settings</h3>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="setting-notifications" checked>
                            Enable browser notifications
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Reminder days before deadline</label>
                        <select id="setting-reminder-days">
                            <option value="1">1 day</option>
                            <option value="3" selected>3 days</option>
                            <option value="7">7 days</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Speaker Modal -->
    <div class="modal-overlay hidden" id="speaker-modal">
        <div class="modal">
            <h2>Add New Speaker</h2>
            <div class="form-group">
                <label>Speaker ID *</label>
                <input type="text" id="speaker-id" placeholder="speaker_001">
            </div>
            <div class="form-group">
                <label>Name *</label>
                <input type="text" id="speaker-name">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="speaker-email">
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="tel" id="speaker-phone">
            </div>
            <div class="form-group">
                <label>Dialect *</label>
                <select id="speaker-dialect">
                    <option value="white_hmong">White Hmong (Hmong Daw)</option>
                    <option value="green_hmong">Green Hmong (Mong Leng)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Origin</label>
                <input type="text" id="speaker-origin" placeholder="Laos, Thailand, etc.">
            </div>
            <div class="form-group">
                <label>Age Range</label>
                <select id="speaker-age">
                    <option value="">Select...</option>
                    <option value="18-25">18-25</option>
                    <option value="26-35">26-35</option>
                    <option value="36-45">36-45</option>
                    <option value="46-55">46-55</option>
                    <option value="56-65">56-65</option>
                    <option value="65+">65+</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="speaker-consent">
                    Consent form signed
                </label>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideModal('speaker-modal')">Cancel</button>
                <button class="btn-primary" onclick="saveSpeaker()">Save Speaker</button>
            </div>
        </div>
    </div>

    <!-- Add Session Modal -->
    <div class="modal-overlay hidden" id="session-modal">
        <div class="modal">
            <h2>Log Recording Session</h2>
            <div class="form-group">
                <label>Speaker *</label>
                <select id="session-speaker"></select>
            </div>
            <div class="form-group">
                <label>Date *</label>
                <input type="date" id="session-date">
            </div>
            <div class="form-group">
                <label>Session Number *</label>
                <select id="session-number">
                    <option value="1">Session 1 - Everyday Phrases</option>
                    <option value="2">Session 2 - Medical Phrases</option>
                    <option value="3">Session 3 - Emergency/Legal/Numbers</option>
                    <option value="4">Session 4 - Free Recording (Stories)</option>
                    <option value="5">Session 5 - Free Recording (Conversation)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Categories Completed</label>
                <input type="text" id="session-categories" placeholder="greetings, family, questions">
            </div>
            <div class="form-group">
                <label>Number of Recordings</label>
                <input type="number" id="session-recordings" value="0">
            </div>
            <div class="form-group">
                <label>Duration (minutes)</label>
                <input type="number" id="session-duration" value="0">
            </div>
            <div class="form-group">
                <label>Quality Rating</label>
                <select id="session-quality">
                    <option value="5">5 - Excellent</option>
                    <option value="4">4 - Good</option>
                    <option value="3">3 - Acceptable</option>
                    <option value="2">2 - Poor</option>
                    <option value="1">1 - Unusable</option>
                </select>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea id="session-notes" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideModal('session-modal')">Cancel</button>
                <button class="btn-primary" onclick="saveSession()">Save Session</button>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal-overlay hidden" id="event-modal">
        <div class="modal">
            <h2>Add Calendar Event</h2>
            <div class="form-group">
                <label>Event Type *</label>
                <select id="event-type">
                    <option value="deadline">Deadline</option>
                    <option value="session">Recording Session</option>
                    <option value="reminder">Reminder</option>
                </select>
            </div>
            <div class="form-group">
                <label>Title *</label>
                <input type="text" id="event-title">
            </div>
            <div class="form-group">
                <label>Date *</label>
                <input type="date" id="event-date">
            </div>
            <div class="form-group">
                <label>Speaker (optional)</label>
                <select id="event-speaker">
                    <option value="">None</option>
                </select>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea id="event-notes" rows="2"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideModal('event-modal')">Cancel</button>
                <button class="btn-primary" onclick="saveEvent()">Save Event</button>
            </div>
        </div>
    </div>

    <!-- Add Phrase Modal -->
    <div class="modal-overlay hidden" id="add-phrase-modal">
        <div class="modal">
            <h2>Add New Phrase</h2>
            <p style="color: var(--text-light); margin-bottom: 1rem;">
                Adding to: <strong id="add-phrase-category-label">-</strong>
            </p>
            <div class="form-group">
                <label>Hmong *</label>
                <input type="text" id="new-phrase-hmong" placeholder="Enter Hmong phrase">
            </div>
            <div class="form-group">
                <label>English *</label>
                <input type="text" id="new-phrase-english" placeholder="Enter English translation">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="hideModal('add-phrase-modal')">Cancel</button>
                <button class="btn-primary" onclick="saveNewPhrase()">Add Phrase</button>
            </div>
        </div>
    </div>

    <script>
        // Data Store
        let data = {
            settings: {
                projectName: 'Hmong Translation Project',
                coordinatorName: '',
                coordinatorEmail: '',
                coordinatorPhone: '',
                notifications: true,
                reminderDays: 3
            },
            speakers: [],
            sessions: [],
            events: [],
            corrections: [],
            checklist: {
                prep: [
                    { id: 'prep-1', title: 'Finalize recording tool', done: false },
                    { id: 'prep-2', title: 'Test recording tool on multiple browsers', done: false },
                    { id: 'prep-3', title: 'Set up cloud storage for files', done: false },
                    { id: 'prep-4', title: 'Create speaker tracking spreadsheet', done: false },
                    { id: 'prep-5', title: 'Prepare consent forms', done: false },
                    { id: 'prep-6', title: 'Finalize speaker instructions', done: false },
                    { id: 'prep-7', title: 'Have native speaker review phrase list', done: false },
                    { id: 'prep-8', title: 'Set up communication channel (email/chat)', done: false }
                ],
                recruit: [
                    { id: 'recruit-1', title: 'Identify potential speakers', done: false },
                    { id: 'recruit-2', title: 'Reach out to community contacts', done: false },
                    { id: 'recruit-3', title: 'Recruit 5 pilot speakers', done: false },
                    { id: 'recruit-4', title: 'Complete pilot testing', done: false },
                    { id: 'recruit-5', title: 'Recruit remaining 20 speakers', done: false },
                    { id: 'recruit-6', title: 'All consent forms signed', done: false },
                    { id: 'recruit-7', title: 'All speakers onboarded', done: false }
                ],
                recording: [
                    { id: 'record-1', title: '25% of recordings complete', done: false },
                    { id: 'record-2', title: '50% of recordings complete', done: false },
                    { id: 'record-3', title: '75% of recordings complete', done: false },
                    { id: 'record-4', title: '100% of recordings complete', done: false },
                    { id: 'record-5', title: 'All files collected and organized', done: false },
                    { id: 'record-6', title: 'Quality review complete', done: false }
                ],
                transcription: [
                    { id: 'trans-1', title: 'Transcription guidelines distributed', done: false },
                    { id: 'trans-2', title: '25% of transcriptions complete', done: false },
                    { id: 'trans-3', title: '50% of transcriptions complete', done: false },
                    { id: 'trans-4', title: '100% of transcriptions complete', done: false },
                    { id: 'trans-5', title: 'Cross-verification complete', done: false },
                    { id: 'trans-6', title: 'Data ready for model training', done: false }
                ]
            },
            activity: []
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('hmong-dashboard-data');
            if (saved) {
                data = JSON.parse(saved);
            }
            render();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('hmong-dashboard-data', JSON.stringify(data));
        }

        // Page navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            document.getElementById(pageId + '-page').classList.add('active');
            event.target.classList.add('active');

            if (pageId === 'calendar') {
                renderCalendar();
            }
        }

        // Modal helpers
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showAddSpeakerModal() {
            const nextId = data.speakers.length + 1;
            document.getElementById('speaker-id').value = `speaker_${String(nextId).padStart(3, '0')}`;
            showModal('speaker-modal');
        }

        function showAddSessionModal() {
            populateSpeakerDropdowns();
            document.getElementById('session-date').value = new Date().toISOString().split('T')[0];
            showModal('session-modal');
        }

        function showAddEventModal() {
            populateSpeakerDropdowns();
            document.getElementById('event-date').value = new Date().toISOString().split('T')[0];
            showModal('event-modal');
        }

        // Populate speaker dropdowns
        function populateSpeakerDropdowns() {
            const selects = ['session-speaker', 'event-speaker'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                const currentValue = select.value;
                select.innerHTML = id === 'event-speaker' ? '<option value="">None</option>' : '';
                data.speakers.forEach(s => {
                    select.innerHTML += `<option value="${s.id}">${s.id} - ${s.name}</option>`;
                });
                select.value = currentValue;
            });
        }

        // Save functions
        function saveSpeaker() {
            const speaker = {
                id: document.getElementById('speaker-id').value,
                name: document.getElementById('speaker-name').value,
                email: document.getElementById('speaker-email').value,
                phone: document.getElementById('speaker-phone').value,
                dialect: document.getElementById('speaker-dialect').value,
                origin: document.getElementById('speaker-origin').value,
                ageRange: document.getElementById('speaker-age').value,
                consent: document.getElementById('speaker-consent').checked,
                sessionsComplete: 0,
                totalRecordings: 0,
                createdAt: new Date().toISOString()
            };

            if (!speaker.id || !speaker.name) {
                alert('Please fill in required fields');
                return;
            }

            data.speakers.push(speaker);
            addActivity(`Added speaker: ${speaker.name}`);
            saveData();
            render();
            hideModal('speaker-modal');
        }

        function saveSession() {
            const session = {
                id: Date.now().toString(),
                speakerId: document.getElementById('session-speaker').value,
                date: document.getElementById('session-date').value,
                sessionNumber: parseInt(document.getElementById('session-number').value),
                categories: document.getElementById('session-categories').value,
                recordings: parseInt(document.getElementById('session-recordings').value),
                duration: parseInt(document.getElementById('session-duration').value),
                quality: parseInt(document.getElementById('session-quality').value),
                notes: document.getElementById('session-notes').value,
                createdAt: new Date().toISOString()
            };

            if (!session.speakerId || !session.date) {
                alert('Please fill in required fields');
                return;
            }

            data.sessions.push(session);

            // Update speaker stats
            const speaker = data.speakers.find(s => s.id === session.speakerId);
            if (speaker) {
                speaker.sessionsComplete = Math.max(speaker.sessionsComplete, session.sessionNumber);
                speaker.totalRecordings += session.recordings;
            }

            addActivity(`Logged session ${session.sessionNumber} for ${session.speakerId}`);
            saveData();
            render();
            hideModal('session-modal');
        }

        function saveEvent() {
            const event = {
                id: Date.now().toString(),
                type: document.getElementById('event-type').value,
                title: document.getElementById('event-title').value,
                date: document.getElementById('event-date').value,
                speakerId: document.getElementById('event-speaker').value,
                notes: document.getElementById('event-notes').value,
                createdAt: new Date().toISOString()
            };

            if (!event.title || !event.date) {
                alert('Please fill in required fields');
                return;
            }

            data.events.push(event);
            addActivity(`Added event: ${event.title}`);
            saveData();
            render();
            hideModal('event-modal');
        }

        function addActivity(message) {
            data.activity.unshift({
                message,
                timestamp: new Date().toISOString()
            });
            if (data.activity.length > 50) {
                data.activity = data.activity.slice(0, 50);
            }
        }

        // Checklist functions
        function toggleChecklist(phase, id) {
            const item = data.checklist[phase].find(i => i.id === id);
            if (item) {
                item.done = !item.done;
                addActivity(`${item.done ? 'Completed' : 'Uncompleted'}: ${item.title}`);
                saveData();
                render();
            }
        }

        // Render functions
        function render() {
            renderStats();
            renderChecklist();
            renderSpeakers();
            renderSessions();
            renderCorrections();
            renderUpcoming();
            renderActivity();
            loadSettings();
        }

        function renderStats() {
            const totalSpeakers = data.speakers.length;
            const totalRecordings = data.sessions.reduce((sum, s) => sum + s.recordings, 0);
            const totalMinutes = data.sessions.reduce((sum, s) => sum + s.duration, 0);
            const totalHours = (totalMinutes / 60).toFixed(1);
            const totalCorrections = data.corrections.length;

            document.getElementById('stat-speakers').textContent = totalSpeakers;
            document.getElementById('stat-recordings').textContent = totalRecordings;
            document.getElementById('stat-hours').textContent = totalHours;
            document.getElementById('stat-corrections').textContent = totalCorrections;

            document.getElementById('progress-speakers').style.width = `${(totalSpeakers / 25) * 100}%`;
            document.getElementById('progress-hours').style.width = `${(totalHours / 125) * 100}%`;
        }

        function renderChecklist() {
            ['prep', 'recruit', 'recording', 'transcription'].forEach(phase => {
                const container = document.getElementById(`checklist-${phase}`);
                container.innerHTML = data.checklist[phase].map(item => `
                    <div class="checklist-item ${item.done ? 'completed' : ''}">
                        <input type="checkbox" ${item.done ? 'checked' : ''}
                               onchange="toggleChecklist('${phase}', '${item.id}')">
                        <div class="checklist-content">
                            <div class="checklist-title">${item.title}</div>
                        </div>
                    </div>
                `).join('');
            });
        }

        function renderSpeakers() {
            const tbody = document.getElementById('speakers-table');
            if (data.speakers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-light);">No speakers yet</td></tr>';
                return;
            }

            tbody.innerHTML = data.speakers.map(s => {
                const status = s.sessionsComplete >= 5 ? 'success' : (s.sessionsComplete > 0 ? 'warning' : 'info');
                const statusText = s.sessionsComplete >= 5 ? 'Complete' : (s.sessionsComplete > 0 ? 'In Progress' : 'Not Started');
                return `
                    <tr>
                        <td>${s.id}</td>
                        <td>${s.name}</td>
                        <td>${s.dialect === 'white_hmong' ? 'White' : 'Green'}</td>
                        <td>${s.sessionsComplete}/5</td>
                        <td>${s.totalRecordings}</td>
                        <td><span class="badge badge-${status}">${statusText}</span></td>
                        <td>
                            <button class="btn-sm btn-secondary" onclick="editSpeaker('${s.id}')">Edit</button>
                            <button class="btn-sm btn-danger" onclick="deleteSpeaker('${s.id}')">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderSessions() {
            const tbody = document.getElementById('sessions-table');
            if (data.sessions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-light);">No sessions logged yet</td></tr>';
                return;
            }

            tbody.innerHTML = data.sessions.sort((a, b) => new Date(b.date) - new Date(a.date)).map(s => `
                <tr>
                    <td>${s.date}</td>
                    <td>${s.speakerId}</td>
                    <td>${s.sessionNumber}</td>
                    <td>${s.categories || '-'}</td>
                    <td>${s.recordings}</td>
                    <td>${s.duration} min</td>
                    <td>${''.repeat(s.quality)}${''.repeat(5 - s.quality)}</td>
                    <td>
                        <button class="btn-sm btn-danger" onclick="deleteSession('${s.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderCorrections() {
            const container = document.getElementById('corrections-list');
            if (data.corrections.length === 0) {
                container.innerHTML = '<div class="empty-state">No corrections submitted yet</div>';
                return;
            }

            container.innerHTML = data.corrections.map((c, idx) => `
                <div class="correction-item">
                    <div><strong>Phrase ID:</strong> ${c.phraseId}</div>
                    <div><span class="correction-original">${c.originalHmong}</span>  <span class="correction-new">${c.newHmong}</span></div>
                    <div><span class="correction-original">${c.originalEnglish}</span>  <span class="correction-new">${c.newEnglish}</span></div>
                    <div class="correction-meta">
                        Submitted by: ${c.speakerId} | ${new Date(c.timestamp).toLocaleDateString()}
                        ${c.reason ? `| Reason: ${c.reason}` : ''}
                    </div>
                    <div style="margin-top: 0.5rem;">
                        <button class="btn-sm btn-success" onclick="approveCorrection(${idx})">Approve</button>
                        <button class="btn-sm btn-danger" onclick="rejectCorrection(${idx})">Reject</button>
                    </div>
                </div>
            `).join('');
        }

        function renderUpcoming() {
            const container = document.getElementById('upcoming-deadlines');
            const today = new Date();
            const upcoming = data.events
                .filter(e => new Date(e.date) >= today)
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(0, 5);

            if (upcoming.length === 0) {
                container.innerHTML = '<div class="empty-state">No upcoming deadlines</div>';
                return;
            }

            container.innerHTML = upcoming.map(e => `
                <div class="notification-item">
                    <div class="notification-icon ${e.type}">${e.type === 'deadline' ? '!' : e.type === 'session' ? '' : ''}</div>
                    <div class="notification-content">
                        <div class="notification-title">${e.title}</div>
                        <div class="notification-time">${e.date}${e.speakerId ? ` - ${e.speakerId}` : ''}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderActivity() {
            const container = document.getElementById('recent-activity');
            if (data.activity.length === 0) {
                container.innerHTML = '<div class="empty-state">No recent activity</div>';
                return;
            }

            container.innerHTML = data.activity.slice(0, 10).map(a => `
                <div class="notification-item">
                    <div class="notification-content">
                        <div class="notification-title">${a.message}</div>
                        <div class="notification-time">${new Date(a.timestamp).toLocaleString()}</div>
                    </div>
                </div>
            `).join('');
        }

        // Calendar
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const label = document.getElementById('calendar-month-label');

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            label.textContent = `${monthNames[currentMonth]} ${currentYear}`;

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = new Date();

            let html = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                .map(d => `<div class="calendar-header">${d}</div>`).join('');

            // Previous month days
            const prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();
            for (let i = firstDay - 1; i >= 0; i--) {
                html += `<div class="calendar-day other-month"><div class="calendar-date">${prevMonthDays - i}</div></div>`;
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = today.getFullYear() === currentYear &&
                               today.getMonth() === currentMonth &&
                               today.getDate() === day;

                const dayEvents = data.events.filter(e => e.date === dateStr);
                const eventsHtml = dayEvents.map(e =>
                    `<div class="calendar-event ${e.type}">${e.title}</div>`
                ).join('');

                html += `<div class="calendar-day ${isToday ? 'today' : ''}">
                    <div class="calendar-date">${day}</div>
                    ${eventsHtml}
                </div>`;
            }

            // Next month days
            const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
            const remaining = totalCells - (firstDay + daysInMonth);
            for (let i = 1; i <= remaining; i++) {
                html += `<div class="calendar-day other-month"><div class="calendar-date">${i}</div></div>`;
            }

            grid.innerHTML = html;

            // Render upcoming events
            renderUpcomingEvents();
        }

        function renderUpcomingEvents() {
            const container = document.getElementById('upcoming-events');
            const today = new Date().toISOString().split('T')[0];
            const upcoming = data.events
                .filter(e => e.date >= today)
                .sort((a, b) => a.date.localeCompare(b.date))
                .slice(0, 10);

            if (upcoming.length === 0) {
                container.innerHTML = '<div class="empty-state">No upcoming events</div>';
                return;
            }

            container.innerHTML = upcoming.map(e => `
                <div class="notification-item">
                    <div class="notification-icon ${e.type}">${e.type === 'deadline' ? '!' : e.type === 'session' ? '' : ''}</div>
                    <div class="notification-content">
                        <div class="notification-title">${e.title}</div>
                        <div class="notification-time">${e.date}${e.speakerId ? ` - ${e.speakerId}` : ''}</div>
                    </div>
                    <button class="btn-sm btn-danger" onclick="deleteEvent('${e.id}')">Delete</button>
                </div>
            `).join('');
        }

        function prevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        // Delete functions
        function deleteSpeaker(id) {
            if (confirm('Delete this speaker?')) {
                data.speakers = data.speakers.filter(s => s.id !== id);
                saveData();
                render();
            }
        }

        function deleteSession(id) {
            if (confirm('Delete this session?')) {
                data.sessions = data.sessions.filter(s => s.id !== id);
                saveData();
                render();
            }
        }

        function deleteEvent(id) {
            if (confirm('Delete this event?')) {
                data.events = data.events.filter(e => e.id !== id);
                saveData();
                render();
            }
        }

        // Corrections
        function importCorrections(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const metadata = JSON.parse(e.target.result);
                    if (metadata.corrections && metadata.corrections.length > 0) {
                        metadata.corrections.forEach(c => {
                            c.speakerId = metadata.speaker?.speakerId || 'unknown';
                        });
                        data.corrections.push(...metadata.corrections);
                        addActivity(`Imported ${metadata.corrections.length} corrections`);
                        saveData();
                        render();
                        alert(`Imported ${metadata.corrections.length} corrections`);
                    } else {
                        alert('No corrections found in this file');
                    }
                } catch (err) {
                    alert('Error reading file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        function approveCorrection(idx) {
            const correction = data.corrections[idx];
            addActivity(`Approved correction for ${correction.phraseId}`);
            data.corrections.splice(idx, 1);
            saveData();
            render();
        }

        function rejectCorrection(idx) {
            const correction = data.corrections[idx];
            addActivity(`Rejected correction for ${correction.phraseId}`);
            data.corrections.splice(idx, 1);
            saveData();
            render();
        }

        // Settings
        function loadSettings() {
            document.getElementById('setting-project-name').value = data.settings.projectName || '';
            document.getElementById('setting-coordinator-name').value = data.settings.coordinatorName || '';
            document.getElementById('setting-coordinator-email').value = data.settings.coordinatorEmail || '';
            document.getElementById('setting-coordinator-phone').value = data.settings.coordinatorPhone || '';
            document.getElementById('setting-notifications').checked = data.settings.notifications !== false;
            document.getElementById('setting-reminder-days').value = data.settings.reminderDays || 3;
        }

        function saveSettings() {
            data.settings = {
                projectName: document.getElementById('setting-project-name').value,
                coordinatorName: document.getElementById('setting-coordinator-name').value,
                coordinatorEmail: document.getElementById('setting-coordinator-email').value,
                coordinatorPhone: document.getElementById('setting-coordinator-phone').value,
                notifications: document.getElementById('setting-notifications').checked,
                reminderDays: parseInt(document.getElementById('setting-reminder-days').value)
            };
            saveData();
            alert('Settings saved!');
        }

        // Export/Import
        function exportAllData() {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hmong-project-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    data = JSON.parse(e.target.result);
                    saveData();
                    render();
                    alert('Data imported successfully!');
                } catch (err) {
                    alert('Error reading file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL data? This cannot be undone.')) {
                if (confirm('Really delete everything?')) {
                    localStorage.removeItem('hmong-dashboard-data');
                    location.reload();
                }
            }
        }

        // Check for notifications
        function checkNotifications() {
            if (!data.settings.notifications) return;

            const today = new Date();
            const reminderDate = new Date();
            reminderDate.setDate(today.getDate() + data.settings.reminderDays);

            data.events.forEach(event => {
                const eventDate = new Date(event.date);
                if (eventDate <= reminderDate && eventDate >= today) {
                    if (Notification.permission === 'granted') {
                        new Notification(`Upcoming: ${event.title}`, {
                            body: `Due: ${event.date}`,
                            icon: ''
                        });
                    }
                }
            });
        }

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Initialize
        loadData();

        // Check notifications every hour
        setInterval(checkNotifications, 3600000);

        // ========== PHRASE EDITOR ==========
        const phrases = {"everyday":{"greetings":[{"hmong":"Nyob zoo","english":"Hello"},{"hmong":"Nyob zoo sawv ntxov","english":"Good morning"},{"hmong":"Nyob zoo tav su","english":"Good afternoon"},{"hmong":"Nyob zoo tsaus ntuj","english":"Good evening"},{"hmong":"Koj nyob li cas?","english":"How are you?"},{"hmong":"Kuv nyob zoo","english":"I am fine"},{"hmong":"Kuv nyob zoo heev","english":"I am very well"},{"hmong":"Kuv nyob tsis zoo","english":"I am not well"},{"hmong":"Ua tsaug","english":"Thank you"},{"hmong":"Ua tsaug ntau","english":"Thank you very much"},{"hmong":"Tsis ua li cas","english":"You're welcome"},{"hmong":"Thov txim","english":"Excuse me / Sorry"},{"hmong":"Tsis txhob ua li cas","english":"No problem"},{"hmong":"Sib ntsib dua","english":"See you again"},{"hmong":"Mus zoo","english":"Goodbye (to person leaving)"},{"hmong":"Nyob zoo","english":"Goodbye (to person staying)"},{"hmong":"Hmo no zoo","english":"Good night"},{"hmong":"Zoo siab ntsib koj","english":"Nice to meet you"},{"hmong":"Kuv zoo siab heev","english":"I am very happy"},{"hmong":"Koj tuaj qhov twg tuaj?","english":"Where are you from?"}],"introductions":[{"hmong":"Kuv lub npe hu ua...","english":"My name is..."},{"hmong":"Koj lub npe hu li cas?","english":"What is your name?"},{"hmong":"Kuv muaj... xyoo","english":"I am ... years old"},{"hmong":"Koj muaj pes tsawg xyoo?","english":"How old are you?"},{"hmong":"Kuv nyob hauv...","english":"I live in..."},{"hmong":"Koj nyob qhov twg?","english":"Where do you live?"},{"hmong":"Kuv yog Hmoob","english":"I am Hmong"},{"hmong":"Kuv hais lus Hmoob","english":"I speak Hmong"},{"hmong":"Kuv hais lus Askiv","english":"I speak English"},{"hmong":"Kuv hais lus Hmoob me ntsis","english":"I speak a little Hmong"},{"hmong":"Kuv tsis paub hais lus Askiv","english":"I don't know how to speak English"},{"hmong":"No yog kuv tsev neeg","english":"This is my family"},{"hmong":"No yog kuv niam","english":"This is my mother"},{"hmong":"No yog kuv txiv","english":"This is my father"},{"hmong":"No yog kuv tus poj niam","english":"This is my wife"},{"hmong":"No yog kuv tus txiv","english":"This is my husband"},{"hmong":"No yog kuv cov me nyuam","english":"These are my children"},{"hmong":"Kuv muaj... tus me nyuam","english":"I have ... children"},{"hmong":"Kuv ua hauj lwm ua...","english":"I work as a..."},{"hmong":"Koj ua hauj lwm dab tsi?","english":"What do you do for work?"}],"family":[{"hmong":"niam","english":"mother"},{"hmong":"txiv","english":"father"},{"hmong":"pog","english":"grandmother (paternal)"},{"hmong":"yawg","english":"grandfather (paternal)"},{"hmong":"niam tais","english":"grandmother (maternal)"},{"hmong":"yawm txiv","english":"grandfather (maternal)"},{"hmong":"tij laug","english":"older brother"},{"hmong":"kwv","english":"younger brother"},{"hmong":"niam hlob","english":"older sister"},{"hmong":"niam ntxawm","english":"younger sister"},{"hmong":"tub","english":"son"},{"hmong":"ntxhais","english":"daughter"},{"hmong":"xeeb ntxwv","english":"grandchild"},{"hmong":"tus poj niam","english":"wife"},{"hmong":"tus txiv","english":"husband"},{"hmong":"me nyuam","english":"child/children"},{"hmong":"kwv tij","english":"brothers/relatives"},{"hmong":"tsev neeg","english":"family"},{"hmong":"niam txiv","english":"parents"},{"hmong":"phauj","english":"aunt (father's sister)"}],"questions":[{"hmong":"Dab tsi?","english":"What?"},{"hmong":"Leej twg?","english":"Who?"},{"hmong":"Qhov twg?","english":"Where?"},{"hmong":"Thaum twg?","english":"When?"},{"hmong":"Vim li cas?","english":"Why?"},{"hmong":"Li cas?","english":"How?"},{"hmong":"Pes tsawg?","english":"How much/many?"},{"hmong":"Puas yog?","english":"Is it?/Right?"},{"hmong":"Koj puas paub?","english":"Do you know?"},{"hmong":"Koj puas nkag siab?","english":"Do you understand?"},{"hmong":"Kuv tsis nkag siab","english":"I don't understand"},{"hmong":"Koj hais dab tsi?","english":"What did you say?"},{"hmong":"Thov hais dua","english":"Please say it again"},{"hmong":"Thov hais qeeb zog","english":"Please speak slower"},{"hmong":"Qhov no hu li cas?","english":"What is this called?"},{"hmong":"Qhov no yog dab tsi?","english":"What is this?"},{"hmong":"Qhov ntawd yog dab tsi?","english":"What is that?"},{"hmong":"Nyob qhov twg?","english":"Where is it?"},{"hmong":"Chav dej nyob qhov twg?","english":"Where is the bathroom?"},{"hmong":"Koj xav tau dab tsi?","english":"What do you want?"}],"common_responses":[{"hmong":"Yog","english":"Yes"},{"hmong":"Tsis yog","english":"No"},{"hmong":"Zoo","english":"Good/Okay"},{"hmong":"Tsis zoo","english":"Not good"},{"hmong":"Tau","english":"Can/Able to"},{"hmong":"Tsis tau","english":"Cannot"},{"hmong":"Paub","english":"Know"},{"hmong":"Tsis paub","english":"Don't know"},{"hmong":"Muaj","english":"Have/There is"},{"hmong":"Tsis muaj","english":"Don't have/There isn't"},{"hmong":"Xav","english":"Want/Think"},{"hmong":"Tsis xav","english":"Don't want"},{"hmong":"Nyiam","english":"Like"},{"hmong":"Tsis nyiam","english":"Don't like"},{"hmong":"Nco","english":"Remember"},{"hmong":"Tsis nco","english":"Don't remember"},{"hmong":"Kuv xav li ntawd thiab","english":"I think so too"},{"hmong":"Kuv tsis paub","english":"I don't know"},{"hmong":"Tej zaum","english":"Maybe"},{"hmong":"Yeej yog li ntawd","english":"That's right"}],"time_expressions":[{"hmong":"hnub no","english":"today"},{"hmong":"nag hmo","english":"yesterday"},{"hmong":"tag kis","english":"tomorrow"},{"hmong":"tam sim no","english":"now"},{"hmong":"tom qab","english":"later/after"},{"hmong":"ua ntej","english":"before"},{"hmong":"sawv ntxov","english":"morning"},{"hmong":"tav su","english":"noon/afternoon"},{"hmong":"tsaus ntuj","english":"evening"},{"hmong":"hmo ntuj","english":"night"},{"hmong":"ib teev","english":"one hour"},{"hmong":"ib feeb","english":"one minute"},{"hmong":"ib lub lim tiam","english":"one week"},{"hmong":"ib hlis","english":"one month"},{"hmong":"ib xyoos","english":"one year"},{"hmong":"Pes tsawg teev lawm?","english":"What time is it?"},{"hmong":"thaum twg","english":"when"},{"hmong":"ntev npaum li cas","english":"how long"},{"hmong":"txhua hnub","english":"every day"},{"hmong":"txhua lub lim tiam","english":"every week"}],"directions_locations":[{"hmong":"sab laug","english":"left"},{"hmong":"sab xis","english":"right"},{"hmong":"ncaj nraim","english":"straight"},{"hmong":"tig","english":"turn"},{"hmong":"nres","english":"stop"},{"hmong":"mus","english":"go"},{"hmong":"los","english":"come"},{"hmong":"ze","english":"near"},{"hmong":"deb","english":"far"},{"hmong":"sab hauv","english":"inside"},{"hmong":"sab nrauv","english":"outside"},{"hmong":"saum","english":"above/up"},{"hmong":"hauv qab","english":"below/down"},{"hmong":"ntawm no","english":"here"},{"hmong":"ntawm ub","english":"there"},{"hmong":"tom tsev","english":"at home"},{"hmong":"tom khw","english":"at the store"},{"hmong":"tom tsev kawm ntawv","english":"at school"},{"hmong":"tom hauj lwm","english":"at work"},{"hmong":"hauv tsheb","english":"in the car"}],"daily_activities":[{"hmong":"Kuv sawv","english":"I wake up"},{"hmong":"Kuv da dej","english":"I take a shower"},{"hmong":"Kuv hnav khaub ncaws","english":"I get dressed"},{"hmong":"Kuv noj tshais","english":"I eat breakfast"},{"hmong":"Kuv noj su","english":"I eat lunch"},{"hmong":"Kuv noj hmo","english":"I eat dinner"},{"hmong":"Kuv mus ua hauj lwm","english":"I go to work"},{"hmong":"Kuv los tsev","english":"I come home"},{"hmong":"Kuv ua noj","english":"I cook"},{"hmong":"Kuv ntxuav tais diav","english":"I wash dishes"},{"hmong":"Kuv tu tsev","english":"I clean the house"},{"hmong":"Kuv ntxhua khaub ncaws","english":"I wash clothes"},{"hmong":"Kuv saib TV","english":"I watch TV"},{"hmong":"Kuv nyeem ntawv","english":"I read"},{"hmong":"Kuv pw","english":"I sleep"},{"hmong":"Kuv mus yuav khoom","english":"I go shopping"},{"hmong":"Kuv tsav tsheb","english":"I drive a car"},{"hmong":"Kuv caij npav","english":"I take the bus"},{"hmong":"Kuv taug kev","english":"I walk"},{"hmong":"Kuv tham xov tooj","english":"I talk on the phone"}],"food_drink":[{"hmong":"mov","english":"rice"},{"hmong":"zaub","english":"vegetables"},{"hmong":"nqaij","english":"meat"},{"hmong":"nqaij npuas","english":"pork"},{"hmong":"nqaij nyuj","english":"beef"},{"hmong":"nqaij qaib","english":"chicken"},{"hmong":"ntses","english":"fish"},{"hmong":"qe","english":"egg"},{"hmong":"kua txob","english":"pepper/chili"},{"hmong":"ntsev","english":"salt"},{"hmong":"dej","english":"water"},{"hmong":"kua mis","english":"milk"},{"hmong":"kas fes","english":"coffee"},{"hmong":"tshuaj yej","english":"tea"},{"hmong":"kua txiv","english":"juice"},{"hmong":"ncuav","english":"bread"},{"hmong":"txiv hmab txiv ntoo","english":"fruit"},{"hmong":"Kuv tshaib plab","english":"I am hungry"},{"hmong":"Kuv nqhis dej","english":"I am thirsty"},{"hmong":"Qab heev","english":"Very delicious"}],"weather":[{"hmong":"hnub ci","english":"sunny"},{"hmong":"los nag","english":"raining"},{"hmong":"los daus","english":"snowing"},{"hmong":"cua ntsawj","english":"windy"},{"hmong":"kub","english":"hot"},{"hmong":"no","english":"cold"},{"hmong":"sov","english":"warm"},{"hmong":"txias","english":"cool"},{"hmong":"Hnub no huab ntuj zoo li cas?","english":"How is the weather today?"},{"hmong":"Hnub no kub heev","english":"Today is very hot"},{"hmong":"Hnub no no heev","english":"Today is very cold"},{"hmong":"Tab tom los nag","english":"It is raining"},{"hmong":"Yuav los nag","english":"It will rain"},{"hmong":"huab ntuj","english":"weather/sky"},{"hmong":"tshav ntuj","english":"clear weather"}],"shopping":[{"hmong":"Qhov no nqi pes tsawg?","english":"How much does this cost?"},{"hmong":"Kim dhau lawm","english":"Too expensive"},{"hmong":"Pheej yig","english":"Cheap"},{"hmong":"Kuv xav yuav qhov no","english":"I want to buy this"},{"hmong":"Kuv tsis xav yuav","english":"I don't want to buy"},{"hmong":"Koj puas txais credit card?","english":"Do you accept credit card?"},{"hmong":"Kuv them nyiaj ntsuab","english":"I pay cash"},{"hmong":"Thov muab daim ntawv txais nyiaj","english":"Please give me the receipt"},{"hmong":"Koj puas muaj qhov loj dua?","english":"Do you have a bigger size?"},{"hmong":"Koj puas muaj xim sib txawv?","english":"Do you have different colors?"},{"hmong":"Kuv tsuas yog saib xwb","english":"I'm just looking"},{"hmong":"Qhov no zoo nkauj heev","english":"This is very beautiful"},{"hmong":"Kuv yuav qhov no","english":"I'll take this"},{"hmong":"nyiaj","english":"money"},{"hmong":"khw","english":"store/market"}],"emotions_states":[{"hmong":"zoo siab","english":"happy"},{"hmong":"tu siab","english":"sad"},{"hmong":"npau taws","english":"angry"},{"hmong":"ntshai","english":"scared/afraid"},{"hmong":"txhawj xeeb","english":"worried"},{"hmong":"nkees","english":"tired"},{"hmong":"tsaug zog","english":"sleepy"},{"hmong":"tsis xis neej","english":"uncomfortable"},{"hmong":"xav tsev","english":"homesick"},{"hmong":"kho siab","english":"lonely"},{"hmong":"Kuv zoo siab heev","english":"I am very happy"},{"hmong":"Kuv tu siab heev","english":"I am very sad"},{"hmong":"Kuv nkees heev","english":"I am very tired"},{"hmong":"Kuv ntshai","english":"I am scared"},{"hmong":"Kuv txhawj xeeb txog koj","english":"I am worried about you"}]},"medical":{"body_parts":[{"hmong":"taubhau","english":"head"},{"hmong":"plaub hau","english":"hair"},{"hmong":"ntsej muag","english":"face"},{"hmong":"qhov muag","english":"eye"},{"hmong":"qhov ntsej","english":"ear"},{"hmong":"qhov ntswg","english":"nose"},{"hmong":"qhov ncauj","english":"mouth"},{"hmong":"hniav","english":"tooth/teeth"},{"hmong":"tus nplaig","english":"tongue"},{"hmong":"caj dab","english":"neck"},{"hmong":"xub pwg","english":"shoulder"},{"hmong":"caj npab","english":"arm"},{"hmong":"luj tshib","english":"elbow"},{"hmong":"dab teg","english":"wrist"},{"hmong":"tes","english":"hand"},{"hmong":"ntiv tes","english":"finger"},{"hmong":"hauv siab","english":"chest"},{"hmong":"nrob qaum","english":"back"},{"hmong":"plab","english":"stomach"},{"hmong":"duav","english":"waist/lower back"},{"hmong":"ncej puab","english":"hip"},{"hmong":"ceg","english":"leg"},{"hmong":"hauv caug","english":"knee"},{"hmong":"pob taws","english":"ankle"},{"hmong":"ko taw","english":"foot"},{"hmong":"ntiv taw","english":"toe"},{"hmong":"tawv nqaij","english":"skin"},{"hmong":"pob txha","english":"bone"},{"hmong":"ntshav","english":"blood"},{"hmong":"lub plawv","english":"heart"}],"symptoms":[{"hmong":"Kuv mob hau","english":"I have a headache"},{"hmong":"Kuv mob plab","english":"I have a stomachache"},{"hmong":"Kuv mob nrob qaum","english":"I have back pain"},{"hmong":"Kuv mob hauv siab","english":"I have chest pain"},{"hmong":"Kuv mob caj dab","english":"I have neck pain"},{"hmong":"Kuv mob caj pas","english":"I have a sore throat"},{"hmong":"Kuv mob hniav","english":"I have a toothache"},{"hmong":"Kuv mob qhov ntsej","english":"I have an earache"},{"hmong":"Kuv ua npaws","english":"I have a fever"},{"hmong":"Kuv ua no","english":"I have chills"},{"hmong":"Kuv hnoos","english":"I have a cough"},{"hmong":"Kuv txham","english":"I am sneezing"},{"hmong":"Kuv qhov ntswg txhaws","english":"I have a stuffy nose"},{"hmong":"Kuv qhov ntswg los kua","english":"I have a runny nose"},{"hmong":"Kuv xav ntuav","english":"I feel nauseous"},{"hmong":"Kuv ntuav","english":"I am vomiting"},{"hmong":"Kuv raws plab","english":"I have diarrhea"},{"hmong":"Kuv cem quav tawv","english":"I am constipated"},{"hmong":"Kuv kiv taubhau","english":"I feel dizzy"},{"hmong":"Kuv tsaus muag","english":"I feel faint"},{"hmong":"Kuv ua tsis taus pa","english":"I can't breathe"},{"hmong":"Kuv ua pa nyuaj","english":"I have difficulty breathing"},{"hmong":"Kuv nkees heev","english":"I am very tired"},{"hmong":"Kuv tsis muaj zog","english":"I have no energy"},{"hmong":"Kuv pw tsis tsaug zog","english":"I can't sleep"},{"hmong":"Kuv o","english":"I am swollen"},{"hmong":"Kuv khaus","english":"I am itchy"},{"hmong":"Kuv ua pob liab","english":"I have a rash"},{"hmong":"Kuv raug mob","english":"I am injured"},{"hmong":"Kuv los ntshav","english":"I am bleeding"}],"chronic_conditions":[{"hmong":"Kuv muaj ntshav qab zib","english":"I have diabetes"},{"hmong":"Kuv muaj ntshav siab","english":"I have high blood pressure"},{"hmong":"Kuv muaj mob plawv","english":"I have heart disease"},{"hmong":"Kuv muaj mob hawb pob","english":"I have asthma"},{"hmong":"Kuv muaj kab mob cancer","english":"I have cancer"},{"hmong":"Kuv muaj mob raum","english":"I have kidney disease"},{"hmong":"Kuv muaj mob siab","english":"I have liver disease"},{"hmong":"Kuv muaj mob pob txha","english":"I have bone/joint problems"},{"hmong":"Kuv muaj mob hlwb","english":"I have a mental health condition"},{"hmong":"Kuv muaj kev nyuaj siab","english":"I have depression"},{"hmong":"Kuv muaj kev txhawj xeeb","english":"I have anxiety"},{"hmong":"Kuv muaj mob qaug dab peg","english":"I have epilepsy/seizures"},{"hmong":"Kuv muaj mob stroke","english":"I had a stroke"},{"hmong":"Kuv xeeb me nyuam tsis tau","english":"I have difficulty getting pregnant"},{"hmong":"Kuv cev xeeb tub","english":"I am pregnant"}],"doctor_questions":[{"hmong":"Koj mob qhov twg?","english":"Where does it hurt?"},{"hmong":"Koj mob ntev npaum li cas lawm?","english":"How long have you been in pain?"},{"hmong":"Koj mob hnyav npaum li cas?","english":"How severe is your pain?"},{"hmong":"Koj puas noj tshuaj?","english":"Are you taking any medications?"},{"hmong":"Koj noj tshuaj dab tsi?","english":"What medications do you take?"},{"hmong":"Koj puas muaj allergy rau tshuaj?","english":"Are you allergic to any medications?"},{"hmong":"Koj puas muaj allergy rau zaub mov?","english":"Do you have any food allergies?"},{"hmong":"Koj tsev neeg puas muaj mob li no?","english":"Does this condition run in your family?"},{"hmong":"Koj puas haus yeeb?","english":"Do you smoke?"},{"hmong":"Koj puas haus dej cawv?","english":"Do you drink alcohol?"},{"hmong":"Koj zaum kawg noj mov thaum twg?","english":"When did you last eat?"},{"hmong":"Koj coj khaub ncaws zaum kawg thaum twg?","english":"When was your last period?"},{"hmong":"Koj puas xeeb me nyuam tau?","english":"Could you be pregnant?"},{"hmong":"Koj puas tau phais?","english":"Have you had any surgeries?"},{"hmong":"Koj puas muaj insurance?","english":"Do you have insurance?"}],"doctor_instructions":[{"hmong":"Noj tshuaj no ib hnub ob zaug","english":"Take this medicine twice a day"},{"hmong":"Noj tshuaj no ib hnub peb zaug","english":"Take this medicine three times a day"},{"hmong":"Noj tshuaj ua ntej noj mov","english":"Take medicine before eating"},{"hmong":"Noj tshuaj tom qab noj mov","english":"Take medicine after eating"},{"hmong":"Haus dej ntau","english":"Drink plenty of water"},{"hmong":"So kom ntau","english":"Get plenty of rest"},{"hmong":"Rov qab tuaj ntsib kuv","english":"Come back to see me"},{"hmong":"Koj yuav tau mus tsev kho mob","english":"You need to go to the hospital"},{"hmong":"Koj yuav tau kuaj ntshav","english":"You need a blood test"},{"hmong":"Koj yuav tau thaij duab X-ray","english":"You need an X-ray"},{"hmong":"Koj yuav tau thaij MRI","english":"You need an MRI"},{"hmong":"Koj yuav tau phais","english":"You need surgery"},{"hmong":"Tsis txhob noj...","english":"Don't eat..."},{"hmong":"Tsis txhob haus dej cawv","english":"Don't drink alcohol"},{"hmong":"Tsis txhob tsav tsheb","english":"Don't drive"}],"patient_questions":[{"hmong":"Kuv mob dab tsi?","english":"What is wrong with me?"},{"hmong":"Qhov no puas loj?","english":"Is this serious?"},{"hmong":"Kuv yuav zoo thaum twg?","english":"When will I get better?"},{"hmong":"Tshuaj no yog dab tsi?","english":"What is this medicine?"},{"hmong":"Tshuaj no muaj side effects dab tsi?","english":"What are the side effects of this medicine?"},{"hmong":"Kuv puas noj tau zaub mov li qub?","english":"Can I eat normally?"},{"hmong":"Kuv puas ua hauj lwm tau?","english":"Can I work?"},{"hmong":"Kuv puas tsav tsheb tau?","english":"Can I drive?"},{"hmong":"Kuv yuav noj tshuaj ntev npaum li cas?","english":"How long do I need to take this medicine?"},{"hmong":"Kuv yuav tsum ua dab tsi ntxiv?","english":"What else should I do?"},{"hmong":"Thaum twg kuv yuav tsum rov qab tuaj?","english":"When should I come back?"},{"hmong":"Kuv puas xav tau tus neeg txhais lus?","english":"Can I have an interpreter?"},{"hmong":"Koj puas hais tau lus Hmoob?","english":"Do you speak Hmong?"},{"hmong":"Thov sau rau hauv ntawv","english":"Please write it down"},{"hmong":"Kuv tsis nkag siab","english":"I don't understand"}],"appointments":[{"hmong":"Kuv xav teem sij hawm ntsib kws kho mob","english":"I want to make a doctor's appointment"},{"hmong":"Kuv muaj appointment hnub no","english":"I have an appointment today"},{"hmong":"Kuv tuaj ntsib Dr. ...","english":"I'm here to see Dr. ..."},{"hmong":"Kuv tuaj kuaj cev","english":"I'm here for a check-up"},{"hmong":"Kuv xav hloov kuv lub sij hawm","english":"I want to change my appointment"},{"hmong":"Kuv xav tshem kuv lub sij hawm","english":"I want to cancel my appointment"},{"hmong":"Koj puas muaj sij hawm sai dua?","english":"Do you have an earlier time?"},{"hmong":"Kuv yuav tos ntev npaum li cas?","english":"How long will I have to wait?"},{"hmong":"Kuv lub insurance yog...","english":"My insurance is..."},{"hmong":"Kuv tsis muaj insurance","english":"I don't have insurance"}],"pharmacy":[{"hmong":"Kuv tuaj nqa kuv cov tshuaj","english":"I'm here to pick up my prescription"},{"hmong":"Kuv yuav tos ntev npaum li cas?","english":"How long will I have to wait?"},{"hmong":"Cov tshuaj no noj li cas?","english":"How do I take this medicine?"},{"hmong":"Kuv yuav noj cov tshuaj no nrog zaub mov?","english":"Should I take this medicine with food?"},{"hmong":"Cov tshuaj no puas muaj generic?","english":"Is there a generic version of this medicine?"},{"hmong":"Cov tshuaj no nqi pes tsawg?","english":"How much does this medicine cost?"},{"hmong":"Kuv tshuaj tas lawm","english":"I ran out of medicine"},{"hmong":"Kuv xav tau tshuaj ntxiv","english":"I need a refill"},{"hmong":"Kuv muaj allergy rau...","english":"I am allergic to..."},{"hmong":"Kuv noj tau cov tshuaj no nrog kuv lwm cov tshuaj?","english":"Can I take this with my other medications?"}]},"emergency":{"urgent_phrases":[{"hmong":"Pab kuv!","english":"Help me!"},{"hmong":"Hu rau 911!","english":"Call 911!"},{"hmong":"Hu rau tub ceev xwm!","english":"Call the police!"},{"hmong":"Hu rau tsheb thauj mob!","english":"Call an ambulance!"},{"hmong":"Hu rau tsheb cawm hluav taws!","english":"Call the fire department!"},{"hmong":"Muaj xwm txheej ceev!","english":"It's an emergency!"},{"hmong":"Kuv xav tau kws kho mob!","english":"I need a doctor!"},{"hmong":"Muaj neeg raug mob!","english":"Someone is hurt!"},{"hmong":"Muaj kev sib tsoo tsheb!","english":"There's been a car accident!"},{"hmong":"Muaj hluav taws kub!","english":"There's a fire!"},{"hmong":"Muaj neeg poob dej!","english":"Someone is drowning!"},{"hmong":"Kuv ploj kev lawm!","english":"I am lost!"},{"hmong":"Muaj neeg raug tub sab!","english":"Someone has been robbed!"},{"hmong":"Kuv tus me nyuam ploj lawm!","english":"My child is missing!"},{"hmong":"Kuv raug tub sab!","english":"I've been robbed!"}],"location_emergency":[{"hmong":"Kuv nyob ntawm...","english":"I am at..."},{"hmong":"Kuv nyob ntawm txoj kev...","english":"I am on ... street"},{"hmong":"Kuv tsis paub kuv nyob qhov twg","english":"I don't know where I am"},{"hmong":"Thov xa neeg tuaj pab","english":"Please send help"},{"hmong":"Tsev kho mob nyob qhov twg?","english":"Where is the hospital?"},{"hmong":"Chaw tub ceev xwm nyob qhov twg?","english":"Where is the police station?"},{"hmong":"Coj kuv mus tsev kho mob","english":"Take me to the hospital"},{"hmong":"Kuv xav tau tsheb thauj mob","english":"I need an ambulance"},{"hmong":"Muaj pes tsawg tus neeg raug mob?","english":"How many people are injured?"},{"hmong":"Neeg raug mob ntawd puas paub teb?","english":"Is the injured person conscious?"}],"medical_emergency":[{"hmong":"Nws tsis ua pa!","english":"They're not breathing!"},{"hmong":"Nws lub plawv tsis ntaus!","english":"Their heart isn't beating!"},{"hmong":"Nws tsaus muag lawm!","english":"They fainted!"},{"hmong":"Nws qaug dab peg!","english":"They're having a seizure!"},{"hmong":"Nws ua tsis taus pa!","english":"They can't breathe!"},{"hmong":"Nws los ntshav ntau!","english":"They're bleeding heavily!"},{"hmong":"Nws tau noj tshuaj ntau dhau!","english":"They overdosed!"},{"hmong":"Nws muaj allergy heev!","english":"They're having a severe allergic reaction!"},{"hmong":"Nws mob hauv siab!","english":"They have chest pain!"},{"hmong":"Kuv xav tias nws stroke!","english":"I think they're having a stroke!"}]},"legal":{"rights":[{"hmong":"Koj muaj cai nyob ntsiag to","english":"You have the right to remain silent"},{"hmong":"Koj muaj cai muaj kws lij choj","english":"You have the right to an attorney"},{"hmong":"Koj puas nkag siab koj cov cai?","english":"Do you understand your rights?"},{"hmong":"Kuv xav tau kws lij choj","english":"I want a lawyer"},{"hmong":"Kuv tsis teb ib lo lus txog thaum kuv muaj kws lij choj","english":"I won't answer questions until I have a lawyer"},{"hmong":"Kuv xav tau tus neeg txhais lus","english":"I need an interpreter"},{"hmong":"Kuv muaj cai tsis teb lus","english":"I have the right not to answer"},{"hmong":"Kuv xav hu xov tooj","english":"I want to make a phone call"},{"hmong":"Kuv muaj cai paub vim li cas koj ntes kuv","english":"I have the right to know why you're arresting me"},{"hmong":"Kuv yog neeg Asmeskas","english":"I am a US citizen"}],"court":[{"hmong":"Kuv lub rooj sib hais nyob thaum twg?","english":"When is my court date?"},{"hmong":"Kuv yuav tsum mus tsev hais plaub qhov twg?","english":"Which courthouse do I go to?"},{"hmong":"Kuv tus kws lij choj nyob qhov twg?","english":"Where is my lawyer?"},{"hmong":"Kuv lees tias kuv tsis muaj txim","english":"I plead not guilty"},{"hmong":"Kuv lees tias kuv muaj txim","english":"I plead guilty"},{"hmong":"Kuv tsis nkag siab","english":"I don't understand"},{"hmong":"Thov hais dua","english":"Please repeat that"},{"hmong":"Kuv xav tau tus neeg txhais lus","english":"I need an interpreter"},{"hmong":"Kuv puas tau tawm ntawm txim?","english":"Can I be released on bail?"},{"hmong":"Kuv txim yog dab tsi?","english":"What are the charges against me?"}],"immigration":[{"hmong":"Kuv yog neeg thoj nam","english":"I am a refugee"},{"hmong":"Kuv yog neeg txawv teb chaws","english":"I am an immigrant"},{"hmong":"Kuv muaj green card","english":"I have a green card"},{"hmong":"Kuv tab tom ua ntaub ntawv thov ua pej xeem","english":"I am applying for citizenship"},{"hmong":"Kuv xav thov asylum","english":"I want to apply for asylum"},{"hmong":"Kuv cov ntaub ntawv nyob qhov twg?","english":"Where are my documents?"},{"hmong":"Kuv xav ntsib kuv tsev neeg","english":"I want to see my family"},{"hmong":"Kuv muaj cai nyob hauv teb chaws no","english":"I have the right to be in this country"},{"hmong":"Thov tsis txhob xa kuv rov qab","english":"Please don't deport me"},{"hmong":"Kuv cov me nyuam yog neeg Asmeskas","english":"My children are US citizens"}]},"numbers":{"cardinal":[{"hmong":"ib","english":"one"},{"hmong":"ob","english":"two"},{"hmong":"peb","english":"three"},{"hmong":"plaub","english":"four"},{"hmong":"tsib","english":"five"},{"hmong":"rau","english":"six"},{"hmong":"xya","english":"seven"},{"hmong":"yim","english":"eight"},{"hmong":"cuaj","english":"nine"},{"hmong":"kaum","english":"ten"},{"hmong":"kaum ib","english":"eleven"},{"hmong":"kaum ob","english":"twelve"},{"hmong":"nees nkaum","english":"twenty"},{"hmong":"peb caug","english":"thirty"},{"hmong":"plaub caug","english":"forty"},{"hmong":"tsib caug","english":"fifty"},{"hmong":"rau caum","english":"sixty"},{"hmong":"xya caum","english":"seventy"},{"hmong":"yim caum","english":"eighty"},{"hmong":"cuaj caum","english":"ninety"},{"hmong":"ib puas","english":"one hundred"},{"hmong":"ib txhiab","english":"one thousand"},{"hmong":"ib vam","english":"ten thousand"},{"hmong":"ib plhom","english":"one million"}],"ordinal":[{"hmong":"thawj","english":"first"},{"hmong":"ob","english":"second"},{"hmong":"peb","english":"third"},{"hmong":"plaub","english":"fourth"},{"hmong":"tsib","english":"fifth"},{"hmong":"zaum kawg","english":"last"}],"time_numbers":[{"hmong":"ib teev","english":"one o'clock"},{"hmong":"ob teev","english":"two o'clock"},{"hmong":"peb teev","english":"three o'clock"},{"hmong":"kaum ob teev","english":"twelve o'clock"},{"hmong":"ib teev peb caug feeb","english":"one thirty"},{"hmong":"ob teev kaum tsib feeb","english":"two fifteen"},{"hmong":"peb teev plaub caug tsib feeb","english":"three forty-five"}],"money":[{"hmong":"ib duas las","english":"one dollar"},{"hmong":"tsib duas las","english":"five dollars"},{"hmong":"kaum duas las","english":"ten dollars"},{"hmong":"nees nkaum duas las","english":"twenty dollars"},{"hmong":"ib puas duas las","english":"one hundred dollars"},{"hmong":"ib xees","english":"one cent"},{"hmong":"nees nkaum tsib xees","english":"twenty-five cents"},{"hmong":"tsib caug xees","english":"fifty cents"}]}};

        // Phrase changes stored in localStorage
        let phraseEdits = {};      // Edits to existing phrases
        let addedPhrases = {};     // New phrases added (keyed by domain_category)
        let deletedPhrases = {};   // Deleted phrases (keyed by domain_category_index)
        let currentPhraseDomain = null;
        let currentPhraseCategory = null;

        function loadPhraseChanges() {
            const savedEdits = localStorage.getItem('hmong-phrase-edits');
            const savedAdded = localStorage.getItem('hmong-phrase-added');
            const savedDeleted = localStorage.getItem('hmong-phrase-deleted');
            if (savedEdits) phraseEdits = JSON.parse(savedEdits);
            if (savedAdded) addedPhrases = JSON.parse(savedAdded);
            if (savedDeleted) deletedPhrases = JSON.parse(savedDeleted);
            updatePhraseEditStats();
        }

        function savePhraseChanges() {
            localStorage.setItem('hmong-phrase-edits', JSON.stringify(phraseEdits));
            localStorage.setItem('hmong-phrase-added', JSON.stringify(addedPhrases));
            localStorage.setItem('hmong-phrase-deleted', JSON.stringify(deletedPhrases));
            updatePhraseEditStats();
        }

        function updatePhraseEditStats() {
            const editCount = Object.keys(phraseEdits).length;
            const addedCount = Object.values(addedPhrases).reduce((sum, arr) => sum + arr.length, 0);
            const deletedCount = Object.keys(deletedPhrases).length;
            const totalChanges = editCount + addedCount + deletedCount;

            document.getElementById('phrase-edit-count').textContent = `${totalChanges} change${totalChanges !== 1 ? 's' : ''}`;
            document.getElementById('stat-edited-phrases').textContent = editCount;
            document.getElementById('stat-added-phrases').textContent = addedCount;
            document.getElementById('stat-deleted-phrases').textContent = deletedCount;

            // Update total phrases count
            let totalPhrases = 475 + addedCount - deletedCount;
            document.getElementById('stat-total-phrases').textContent = totalPhrases;
        }

        function updateCategorySelect() {
            const domain = document.getElementById('phrase-domain-select').value;
            const categorySelect = document.getElementById('phrase-category-select');
            const addBtn = document.getElementById('add-phrase-btn');

            if (!domain) {
                categorySelect.disabled = true;
                categorySelect.innerHTML = '<option value="">Select Category...</option>';
                addBtn.disabled = true;
                return;
            }

            categorySelect.disabled = false;
            const categories = Object.keys(phrases[domain] || {});
            categorySelect.innerHTML = '<option value="">Select Category...</option>' +
                categories.map(cat => {
                    const displayName = cat.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    const addedKey = `${domain}_${cat}`;
                    const baseCount = phrases[domain][cat].length;
                    const addedCount = (addedPhrases[addedKey] || []).length;
                    const deletedCount = Object.keys(deletedPhrases).filter(k => k.startsWith(addedKey + '_')).length;
                    const totalCount = baseCount + addedCount - deletedCount;
                    return `<option value="${cat}">${displayName} (${totalCount})</option>`;
                }).join('');
        }

        function loadPhraseCategory() {
            const domain = document.getElementById('phrase-domain-select').value;
            const category = document.getElementById('phrase-category-select').value;
            const addBtn = document.getElementById('add-phrase-btn');

            if (!domain || !category) {
                addBtn.disabled = true;
                document.getElementById('phrase-list').innerHTML = `
                    <div class="card">
                        <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                            Select a domain and category above to edit phrases
                        </p>
                    </div>
                `;
                return;
            }

            addBtn.disabled = false;
            currentPhraseDomain = domain;
            currentPhraseCategory = category;
            renderPhraseList();
        }

        function renderPhraseList(filter = '') {
            if (!currentPhraseDomain || !currentPhraseCategory) return;

            const basePhrases = phrases[currentPhraseDomain][currentPhraseCategory] || [];
            const addedKey = `${currentPhraseDomain}_${currentPhraseCategory}`;
            const added = addedPhrases[addedKey] || [];
            const container = document.getElementById('phrase-list');

            // Combine base phrases (excluding deleted) and added phrases
            let allPhrases = [];

            // Add base phrases that aren't deleted
            basePhrases.forEach((p, i) => {
                const deleteKey = `${currentPhraseDomain}_${currentPhraseCategory}_${i}`;
                if (!deletedPhrases[deleteKey]) {
                    allPhrases.push({ ...p, originalIndex: i, isAdded: false });
                }
            });

            // Add new phrases
            added.forEach((p, i) => {
                allPhrases.push({ ...p, addedIndex: i, isAdded: true });
            });

            // Filter
            const filteredPhrases = allPhrases.filter(p => {
                if (!filter) return true;
                const searchLower = filter.toLowerCase();
                const editKey = p.isAdded ? null : `${currentPhraseDomain}_${currentPhraseCategory}_${p.originalIndex}`;
                const edit = editKey ? phraseEdits[editKey] : null;
                const hmong = edit ? edit.hmong : p.hmong;
                const english = edit ? edit.english : p.english;
                return hmong.toLowerCase().includes(searchLower) ||
                       english.toLowerCase().includes(searchLower);
            });

            if (filteredPhrases.length === 0) {
                container.innerHTML = `
                    <div class="card">
                        <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                            No phrases match your search
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredPhrases.map((p, displayIdx) => {
                if (p.isAdded) {
                    // Added phrase
                    return `
                        <div class="phrase-card" style="border-color: var(--success); background: #f0fdf4;">
                            <div class="phrase-number">
                                NEW <span class="edited-badge" style="background: var(--success);">ADDED</span>
                            </div>
                            <div class="phrase-content">
                                <div class="phrase-field">
                                    <label>Hmong</label>
                                    <input type="text" value="${p.hmong}" onchange="updateAddedPhrase(${p.addedIndex}, 'hmong', this.value)">
                                </div>
                                <div class="phrase-field">
                                    <label>English</label>
                                    <input type="text" value="${p.english}" onchange="updateAddedPhrase(${p.addedIndex}, 'english', this.value)">
                                </div>
                            </div>
                            <div class="phrase-actions">
                                <button class="btn-sm btn-danger" onclick="removeAddedPhrase(${p.addedIndex})">Remove</button>
                            </div>
                        </div>
                    `;
                } else {
                    // Original phrase (possibly edited)
                    const editKey = `${currentPhraseDomain}_${currentPhraseCategory}_${p.originalIndex}`;
                    const edit = phraseEdits[editKey];
                    const isEdited = !!edit;
                    const hmong = edit ? edit.hmong : p.hmong;
                    const english = edit ? edit.english : p.english;

                    return `
                        <div class="phrase-card ${isEdited ? 'edited' : ''}" data-key="${editKey}">
                            <div class="phrase-number">
                                #${p.originalIndex + 1}
                                ${isEdited ? '<span class="edited-badge">EDITED</span>' : ''}
                            </div>
                            <div class="phrase-content">
                                <div class="phrase-field">
                                    <label>Hmong</label>
                                    <input type="text" value="${hmong}" data-field="hmong" data-key="${editKey}" data-original="${p.hmong}" onchange="updatePhraseEdit(this)">
                                </div>
                                <div class="phrase-field">
                                    <label>English</label>
                                    <input type="text" value="${english}" data-field="english" data-key="${editKey}" data-original="${p.english}" onchange="updatePhraseEdit(this)">
                                </div>
                            </div>
                            <div class="phrase-actions">
                                ${isEdited ? `<button class="btn-sm btn-secondary" onclick="revertPhraseEdit('${editKey}')">Revert</button>` : ''}
                                <button class="btn-sm btn-danger" onclick="deletePhrase('${editKey}', ${p.originalIndex})">Delete</button>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        function filterPhrases() {
            const filter = document.getElementById('phrase-search').value;
            renderPhraseList(filter);
        }

        function updatePhraseEdit(input) {
            const key = input.dataset.key;
            const field = input.dataset.field;
            const newValue = input.value.trim();

            // Parse key to get original phrase
            const parts = key.split('_');
            const idx = parseInt(parts.pop());
            const category = parts.slice(1).join('_');
            const domain = parts[0];

            const originalPhrase = phrases[domain][category][idx];
            if (!originalPhrase) return;

            // Get or create edit entry
            if (!phraseEdits[key]) {
                phraseEdits[key] = {
                    hmong: originalPhrase.hmong,
                    english: originalPhrase.english,
                    originalHmong: originalPhrase.hmong,
                    originalEnglish: originalPhrase.english,
                    editedAt: new Date().toISOString()
                };
            }

            phraseEdits[key][field] = newValue;
            phraseEdits[key].editedAt = new Date().toISOString();

            // Check if it's back to original
            if (phraseEdits[key].hmong === phraseEdits[key].originalHmong &&
                phraseEdits[key].english === phraseEdits[key].originalEnglish) {
                delete phraseEdits[key];
            }

            savePhraseChanges();
            renderPhraseList(document.getElementById('phrase-search').value);
        }

        function revertPhraseEdit(key) {
            if (confirm('Revert this phrase to the original?')) {
                delete phraseEdits[key];
                savePhraseChanges();
                renderPhraseList(document.getElementById('phrase-search').value);
            }
        }

        function deletePhrase(key, originalIndex) {
            if (confirm('Delete this phrase? This can be undone by clicking "Restore" later.')) {
                deletedPhrases[key] = {
                    deletedAt: new Date().toISOString(),
                    originalIndex: originalIndex
                };
                // Also remove any edits for this phrase
                delete phraseEdits[key];
                savePhraseChanges();
                renderPhraseList(document.getElementById('phrase-search').value);
                updateCategorySelect(); // Update category counts
            }
        }

        // Add phrase functions
        function showAddPhraseModal() {
            if (!currentPhraseDomain || !currentPhraseCategory) {
                alert('Please select a domain and category first');
                return;
            }
            const displayName = currentPhraseCategory.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('add-phrase-category-label').textContent = `${currentPhraseDomain} > ${displayName}`;
            document.getElementById('new-phrase-hmong').value = '';
            document.getElementById('new-phrase-english').value = '';
            showModal('add-phrase-modal');
        }

        function saveNewPhrase() {
            const hmong = document.getElementById('new-phrase-hmong').value.trim();
            const english = document.getElementById('new-phrase-english').value.trim();

            if (!hmong || !english) {
                alert('Please enter both Hmong and English text');
                return;
            }

            const addedKey = `${currentPhraseDomain}_${currentPhraseCategory}`;
            if (!addedPhrases[addedKey]) {
                addedPhrases[addedKey] = [];
            }

            addedPhrases[addedKey].push({
                hmong,
                english,
                addedAt: new Date().toISOString()
            });

            savePhraseChanges();
            hideModal('add-phrase-modal');
            renderPhraseList(document.getElementById('phrase-search').value);
            updateCategorySelect(); // Update category counts
        }

        function updateAddedPhrase(addedIndex, field, value) {
            const addedKey = `${currentPhraseDomain}_${currentPhraseCategory}`;
            if (addedPhrases[addedKey] && addedPhrases[addedKey][addedIndex]) {
                addedPhrases[addedKey][addedIndex][field] = value.trim();
                addedPhrases[addedKey][addedIndex].editedAt = new Date().toISOString();
                savePhraseChanges();
            }
        }

        function removeAddedPhrase(addedIndex) {
            if (confirm('Remove this phrase?')) {
                const addedKey = `${currentPhraseDomain}_${currentPhraseCategory}`;
                if (addedPhrases[addedKey]) {
                    addedPhrases[addedKey].splice(addedIndex, 1);
                    if (addedPhrases[addedKey].length === 0) {
                        delete addedPhrases[addedKey];
                    }
                    savePhraseChanges();
                    renderPhraseList(document.getElementById('phrase-search').value);
                    updateCategorySelect();
                }
            }
        }

        function exportEditedPhrases() {
            const editCount = Object.keys(phraseEdits).length;
            const addedCount = Object.values(addedPhrases).reduce((sum, arr) => sum + arr.length, 0);
            const deletedCount = Object.keys(deletedPhrases).length;

            if (editCount === 0 && addedCount === 0 && deletedCount === 0) {
                alert('No changes to export');
                return;
            }

            // Create a modified copy of phrases with all changes applied
            const modifiedPhrases = JSON.parse(JSON.stringify(phrases));

            // Apply edits
            Object.entries(phraseEdits).forEach(([key, edit]) => {
                for (const domain of Object.keys(modifiedPhrases)) {
                    for (const category of Object.keys(modifiedPhrases[domain])) {
                        const prefix = `${domain}_${category}_`;
                        if (key.startsWith(prefix)) {
                            const idx = parseInt(key.replace(prefix, ''));
                            if (modifiedPhrases[domain][category][idx]) {
                                modifiedPhrases[domain][category][idx].hmong = edit.hmong;
                                modifiedPhrases[domain][category][idx].english = edit.english;
                            }
                        }
                    }
                }
            });

            // Remove deleted phrases (in reverse order to preserve indices)
            const deletedByCategory = {};
            Object.keys(deletedPhrases).forEach(key => {
                for (const domain of Object.keys(modifiedPhrases)) {
                    for (const category of Object.keys(modifiedPhrases[domain])) {
                        const prefix = `${domain}_${category}_`;
                        if (key.startsWith(prefix)) {
                            const idx = parseInt(key.replace(prefix, ''));
                            const catKey = `${domain}_${category}`;
                            if (!deletedByCategory[catKey]) deletedByCategory[catKey] = [];
                            deletedByCategory[catKey].push({ domain, category, idx });
                        }
                    }
                }
            });

            Object.values(deletedByCategory).forEach(items => {
                items.sort((a, b) => b.idx - a.idx); // Sort descending
                items.forEach(item => {
                    modifiedPhrases[item.domain][item.category].splice(item.idx, 1);
                });
            });

            // Add new phrases
            Object.entries(addedPhrases).forEach(([key, phrases]) => {
                const parts = key.split('_');
                const domain = parts[0];
                const category = parts.slice(1).join('_');
                if (modifiedPhrases[domain] && modifiedPhrases[domain][category]) {
                    phrases.forEach(p => {
                        modifiedPhrases[domain][category].push({
                            hmong: p.hmong,
                            english: p.english
                        });
                    });
                }
            });

            const exportData = {
                exportDate: new Date().toISOString(),
                summary: {
                    totalEdits: editCount,
                    totalAdded: addedCount,
                    totalDeleted: deletedCount
                },
                changes: {
                    edits: phraseEdits,
                    added: addedPhrases,
                    deleted: deletedPhrases
                },
                modifiedPhrases: modifiedPhrases
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hmong-phrases-modified-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load phrase changes on page load
        loadPhraseChanges();
    </script>
</body>
</html>
